<!doctype html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="raphael-min.js"></script>
<script src="/release/flowchart.js"></script>
  <head>
    <title>Demo page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
  </head>
  <body>
	<textarea id="codearea">
	
	</textarea>
  
  
	<textarea id="chart2">
		st=>start: Start:>http://www.google.com[blank]
		e=>end:>http://www.google.com
		op1=>operation: My Operation
		sub1=>subroutine: My Subroutine
		cond=>condition: Yes
		or No?:>http://www.google.com
		io=>inputoutput: catch something...
		para=>parallel: parallel tasks

		st->op1->cond
		cond(yes)->io->e
		cond(no)->para
		para(path1, bottom)->sub1(right)->op1
		para(path2, top)->op1
	</textarea>
	
	<!--location for diagram-->
	<div id='dia'>
	</div>
	
	<script>
	debounce = (func, timeout = 500) => {
	  let timer;
	  return (...args) => {
		clearTimeout(timer);
		timer = setTimeout(() => { func.apply(this, args); }, timeout);
	  }
	}
	//use it like: const processChange = debounce(() => saveInput());
	
	
	$("#codearea").on("change keyup", debounce(()=>{
		$.post( "cgi-bin/c.py", { 
			code: $("#codearea").val()
		}).done(data=>{
			$("#chart2").val(data)
			if (data!=''){
				$("#chart2").trigger('started');
			}
		})
		//event.stopPropagation()
	}))
	
	
	$("#chart2").on("started change keyup", ()=>{
		$('#dia').html('')
		var diagram = flowchart.parse($('#chart2').val());
		diagram.drawSVG('dia');
	})
	//This happens once:
	$("#chart2").trigger('started');
	</script>
  </body>
</html>
